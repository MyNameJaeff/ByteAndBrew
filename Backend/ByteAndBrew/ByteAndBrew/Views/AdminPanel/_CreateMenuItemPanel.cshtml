@{
    /* _CreateMenuItemPanel.cshtml */
}
@model ByteAndBrew.Dtos.MenuItem.MenuItemCreateDto

<form action="/AdminPanel/CreateMenuItem" method="post" class="bg-green-50 p-6 rounded-xl shadow-md">
    @Html.AntiForgeryToken()

    <h3 class="text-lg font-semibold text-gray-800 mb-4">
        <i class="fas fa-utensils mr-2 text-green-600"></i>Add New Menu Item
    </h3>

    <!-- Error Display -->
    <div id="form-errors" class="hidden mb-4 p-4 bg-red-50 border border-red-200 rounded-lg">
        <div class="flex items-start">
            <i class="fas fa-exclamation-circle text-red-500 mr-2 mt-1"></i>
            <div>
                <p class="font-medium text-red-800 mb-1">Please correct the following errors:</p>
                <ul class="text-red-600 text-sm list-disc list-inside space-y-1"></ul>
            </div>
        </div>
    </div>

    <!-- Success Display -->
    <div id="form-success" class="hidden mb-4 p-4 bg-green-50 border border-green-200 rounded-lg">
        <div class="flex items-center">
            <i class="fas fa-check-circle text-green-500 mr-2"></i>
            <p class="text-green-800 font-medium"></p>
        </div>
    </div>

    <div class="mb-4">
        <label class="block text-gray-700 font-medium mb-2">Item Name *</label>
        <input name="Name" type="text" required maxlength="100"
               placeholder="e.g., Caesar Salad"
               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" />
    </div>

    <div class="mb-4">
        <label class="block text-gray-700 font-medium mb-2">Description *</label>
        <textarea name="Description" rows="3" maxlength="500" required
                  placeholder="Describe the dish..."
                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500"></textarea>
    </div>

    <div class="mb-4">
        <label class="block text-gray-700 font-medium mb-2">Price (SEK) *</label>
        <input name="Price" type="number" step="0.01" min="0.1" max="9999.99" required
               placeholder="149.00"
               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" />
    </div>

    <div class="mb-4">
        <label class="block text-gray-700 font-medium mb-2">Image URL</label>
        <input name="ImageUrl" type="url" placeholder="https://example.com/image.jpg"
               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" />
    </div>

    <div class="mb-4">
        <label class="block text-gray-700 font-medium mb-2">
            <input name="IsPopular" type="checkbox" class="mr-2" />
            Mark as Popular
        </label>
    </div>

    <div class="flex gap-2">
        <button type="submit"
                class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg font-medium transition-colors duration-200 flex items-center justify-center">
            <i class="fas fa-save mr-2"></i>
            <span>Add Menu Item</span>
            <i class="fas fa-spinner fa-spin ml-2 !hidden" id="submit-spinner"></i>
        </button>
        <button type="button"
                onclick="closeQuickForm(this)"
                class="px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-200">
            Cancel
        </button>
    </div>
</form>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('form[action="/AdminPanel/CreateMenuItem"]');
        if (!form) return;

        const errorBox = document.getElementById('form-errors');
        const errorList = errorBox.querySelector('ul');
        const successBox = document.getElementById('form-success');
        const successMsg = successBox.querySelector('p');

        const submitBtn = form.querySelector('button[type="submit"]');
        const spinner = document.getElementById('submit-spinner');

        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            submitBtn.disabled = true;
            spinner.classList.remove('!hidden');

            // Clear previous messages
            errorBox.classList.add('hidden');
            errorList.innerHTML = '';
            successBox.classList.add('hidden');

            const formData = new FormData(form);

            try {
                const res = await fetch(form.action, {
                    method: 'POST',
                    body: formData
                });

                if (res.ok) {
                    successMsg.textContent = 'Menu item added successfully!';
                    successBox.classList.remove('hidden');
                    form.reset();
                } else {
                    const data = await res.json();
                    if (data.errors) {
                        for (const err of Object.values(data.errors)) {
                            const li = document.createElement('li');
                            li.textContent = err;
                            errorList.appendChild(li);
                        }
                        errorBox.classList.remove('hidden');
                    } else {
                        alert('Failed to add menu item');
                    }
                }
            } catch (err) {
                alert('Error: ' + err.message);
            } finally {
                submitBtn.disabled = false;
                spinner.classList.add('hidden');
            }
        });
    });

    // Close form function
    function closeQuickForm(btn) {
        const container = btn.closest('.quick-form-container');
        if (!container) return;
        container.classList.add('hidden');
        container.innerHTML = '';
        const prevBtn = container.previousElementSibling;
        if (prevBtn) prevBtn.disabled = false;
    }
</script>
